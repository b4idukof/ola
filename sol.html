<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solana Transfer</title>
  <script src="https://unpkg.com/@solana/web3.js@1.33.0/lib/index.iife.js"></script>
</head>

<body>
  <div>
    <h1>Transfer SOL</h1>
    <button id="connect-button" onclick="connectWallet()">Connect Wallet</button>
    <div id="wallet-info" style="display:none;">
      <p><strong>Wallet:</strong> <span id="wallet-address"></span></p>
      <input id="receiver" type="text" placeholder="Recipient Address" />
      <input id="amount" type="number" placeholder="Amount (SOL)" />
      <button onclick="transferSOL()">Send SOL</button>
    </div>
    <p id="status"></p>
  </div>

  <script>
    let wallet = null;
    const LAMPORTS_PER_SOL = solanaWeb3.LAMPORTS_PER_SOL;

    async function connectWallet() {
      try {
        wallet = await window.solana.connect();
        document.getElementById("connect-button").style.display = "none";
        document.getElementById("wallet-info").style.display = "block";
        document.getElementById("wallet-address").innerText = wallet.publicKey.toString();
        setStatus("Wallet connected!", "success");
      } catch (err) {
        setStatus("Failed to connect wallet: " + err.message, "error");
      }
    }

    async function transferSOL() {
      const receiverAddress = document.getElementById("receiver").value;
      const amount = parseFloat(document.getElementById("amount").value);

      if (!receiverAddress || !solanaWeb3.PublicKey.isOnCurve(new solanaWeb3.PublicKey(receiverAddress))) {
        setStatus("Invalid recipient address.", "error");
        return;
      }

      if (!amount || amount <= 0) {
        setStatus("Invalid amount. Must be greater than 0.", "error");
        return;
      }

      try {
        // Connect to custom RPC (GenesysGo as an example)
        const connection = new solanaWeb3.Connection("https://ssc-dao.genesysgo.net", "confirmed");

        const lamports = amount * LAMPORTS_PER_SOL;
        const transaction = new solanaWeb3.Transaction();
        const instruction = solanaWeb3.SystemProgram.transfer({
          fromPubkey: wallet.publicKey,
          toPubkey: new solanaWeb3.PublicKey(receiverAddress),
          lamports,
        });

        transaction.add(instruction);

        const { blockhash } = await connection.getLatestBlockhash("finalized");
        transaction.recentBlockhash = blockhash;
        transaction.feePayer = wallet.publicKey;

        const signedTransaction = await wallet.signTransaction(transaction);
        const signature = await connection.sendRawTransaction(signedTransaction.serialize());
        await connection.confirmTransaction(signature, "confirmed");

        setStatus("Transaction successful! Signature: " + signature, "success");
      } catch (err) {
        setStatus("Transaction failed: " + err.message, "error");
      }
    }

    function setStatus(message, type) {
      const statusElement = document.getElementById("status");
      statusElement.innerText = message;
      statusElement.style.color = type === "success" ? "green" : "red";
    }
  </script>
</body>

</html>
